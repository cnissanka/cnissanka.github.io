<!DOCTYPE html><html><head><meta charset="utf-8"><title>bitarrayblog.md</title><style></style></head><body id="preview">
<h1 class="code-line" data-line-start=0 data-line-end=1 ><a id="A_bit_about_bit_arrays_0"></a>A bit about bit arrays</h1>
<p class="has-line-data" data-line-start="2" data-line-end="3">Bit manipulation is a tool that can be used by programmers to make their code more efficent. Therefore writing and reading bit arrays should be a skill in any programmer’s arsenal. In this post I will be explaining exactly how to create a bit array, insert bits into the array and delete bits from the bit array.</p>
<h2 class="code-line" data-line-start=4 data-line-end=5 ><a id="What_is_bit_shifting_4"></a>What is bit shifting?</h2>
<p class="has-line-data" data-line-start="5" data-line-end="7">Bit shifting is simply shifting a bit from a given position to another position by a number of times.<br>
Therefore,</p>
<pre><code class="has-line-data" data-line-start="8" data-line-end="10" class="language-c++"><span class="hljs-keyword">int</span> x = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">5</span>; 
</code></pre>
<p class="has-line-data" data-line-start="10" data-line-end="14">means shifting an integer with the value of 1, 5 positions to the left.<br>
An integer is a value with 32 bits or 4 bytes. (1 byte is equal to 8 bits)<br>
Therefore when visualizing a 32 bit integer, we can see this as an array of 32 elements,<br>
0000 0000 0000 0000 0000 0000 0000 0001</p>
<p class="has-line-data" data-line-start="15" data-line-end="17">When we shift this array by 5, this is the result<br>
0000 0000 0000 0000 0000 0000 0001 0000</p>
<h2 class="code-line" data-line-start=18 data-line-end=19 ><a id="How_to_create_a_bit_array_18"></a>How to create a bit array?</h2>
<p class="has-line-data" data-line-start="19" data-line-end="20">One can simply define a bit array by using the following code,</p>
<pre><code class="has-line-data" data-line-start="22" data-line-end="26" class="language-c"><span class="hljs-keyword">int</span> [] A = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[<span class="hljs-number">32</span>]; 
A[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>; 
A[<span class="hljs-number">2</span>] = <span class="hljs-number">1</span>; 
</code></pre>
<p class="has-line-data" data-line-start="26" data-line-end="28">However this is an inefficent design, because a single array index can store 32 bits,<br>
but we are using only storing one bit! The rest of the space isn’t used. This is where bit manipulation comes in, to optimize this structure. In the current array we can actually store 32^(32) bits, which is 1.4615016e+48 bits! Let’s write an efficent implementation to harness the full capacity of the array.</p>
<h2 class="code-line" data-line-start=29 data-line-end=30 ><a id="Inserting_a_bit_to_the_array_29"></a>Inserting a bit to the array</h2>
<p class="has-line-data" data-line-start="30" data-line-end="31">Let’s define a bit array as before (integer array)</p>
<pre><code class="has-line-data" data-line-start="32" data-line-end="34" class="language-c"><span class="hljs-keyword">int</span> [] A = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[<span class="hljs-number">32</span>]; 
</code></pre>
<p class="has-line-data" data-line-start="34" data-line-end="35">To insert a bit to the array, we need to determine which index the bit would go into. Right now we have 32 indexes where a given bit can go into. We simply have to divide the index where we are going to write the bit by the size of the array (32).</p>
<pre><code class="has-line-data" data-line-start="37" data-line-end="40" class="language-c"><span class="hljs-keyword">int</span> k = <span class="hljs-number">3</span>; <span class="hljs-comment">// bit we are going to write to the array </span>
<span class="hljs-keyword">int</span> position = k / <span class="hljs-number">32</span>; <span class="hljs-comment">// bit position in the array</span>
</code></pre>
<p class="has-line-data" data-line-start="41" data-line-end="43">After we have determined the position we are going to write, we need to decide, which position inside the integer we are going to write to. There are 32 bits in an integer, therefore we need to decide which bit we are going to change from a 0 to a 1.<br>
This is done by the mod operator (%).</p>
<pre><code class="has-line-data" data-line-start="44" data-line-end="46" class="language-c"><span class="hljs-keyword">int</span> index = k % <span class="hljs-number">32</span>; 
</code></pre>
<p class="has-line-data" data-line-start="46" data-line-end="50">Since we have both the index position of the array and the integer position figured out we need to change the bit from a 0 to a 1. This is done by creating a mask. A mask is an integer (32 bit value) which can be used to do a binary operation (e.g AND/OR/XOR), which changes the bit value. To create a mask to add a bit to the array, we start with a simple 32 bit value such as 1.<br>
1 = 0000 0000 0000 0000 0000 0000 0000 0001<br>
We need to shift it to the position we would like to change. Which is k % 32.<br>
Therefore we use bit shifting to create a desired mask,</p>
<pre><code class="has-line-data" data-line-start="51" data-line-end="53" class="language-c"><span class="hljs-keyword">int</span> mask = <span class="hljs-number">1</span> &lt;&lt; (k%<span class="hljs-number">32</span>) 
</code></pre>
<p class="has-line-data" data-line-start="53" data-line-end="54">When the mask is known, to add a value to the current bit array, we use the OR operator. Therefore the full implementation for adding a value to the bit array is as follows,</p>
<pre><code class="has-line-data" data-line-start="56" data-line-end="65" class="language-c"><span class="hljs-keyword">int</span> k = <span class="hljs-number">3</span>; 
<span class="hljs-keyword">int</span> [] A = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span> [<span class="hljs-number">32</span>]; 

<span class="hljs-keyword">int</span> position = k/<span class="hljs-number">32</span>; 
<span class="hljs-keyword">int</span> index = k % <span class="hljs-number">32</span>;
<span class="hljs-keyword">int</span> mask = <span class="hljs-number">1</span> &lt;&lt; (k%<span class="hljs-number">32</span>) 

A[position] = A[position] | mask;  <span class="hljs-comment">//adding a bit to the array using OR</span>
</code></pre>
<p class="has-line-data" data-line-start="65" data-line-end="66">Here is a compressed version of the above implementation,</p>
<pre><code class="has-line-data" data-line-start="67" data-line-end="71" class="language-c"><span class="hljs-keyword">int</span> k = <span class="hljs-number">3</span>; 
<span class="hljs-keyword">int</span> [] A = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[<span class="hljs-number">32</span>]; 
A[k/<span class="hljs-number">32</span>] |= <span class="hljs-number">1</span> &lt;&lt; (k%<span class="hljs-number">32</span>);
</code></pre>
<h2 class="code-line" data-line-start=73 data-line-end=74 ><a id="Delete_a_bit_from_the_array_73"></a>Delete a bit from the array</h2>
<p class="has-line-data" data-line-start="74" data-line-end="76">To delete a bit from the array, which is converting a bit from 1 to 0, is as follows,<br>
Most of the code is the same, except to clear a value, we need to preserve the other bits but change the bit that we need to change. To do this we need to modify our mask and we need to use the AND operator.</p>
<p class="has-line-data" data-line-start="77" data-line-end="78">To modify the mask, we need to create the mask as we did earlier, however this time we need to invert the mask. Which is changing all the zeros to ones and vice versa.</p>
<p class="has-line-data" data-line-start="79" data-line-end="81">Here is the mask we start with,<br>
0000 0000 0000 0000 0000 0000 0000 0001</p>
<p class="has-line-data" data-line-start="82" data-line-end="84">Here is how we shift it, (e.g. 1 &lt;&lt; 3)<br>
0000 0000 0000 0000 0000 0000 0000 0100</p>
<p class="has-line-data" data-line-start="85" data-line-end="87">Here we invert the mask<br>
1111 1111 1111 1111 1111 1111 1111 1011</p>
<p class="has-line-data" data-line-start="88" data-line-end="89">Therefore when we use the AND operator, the values are preserved, but our target bit position is changed.</p>
<p class="has-line-data" data-line-start="90" data-line-end="91">Here is the implementation in C,</p>
<pre><code class="has-line-data" data-line-start="92" data-line-end="103" class="language-c"><span class="hljs-keyword">int</span> k = <span class="hljs-number">3</span>; 
<span class="hljs-keyword">int</span> A [<span class="hljs-number">32</span>]; 
<span class="hljs-keyword">int</span> pos = k/<span class="hljs-number">32</span>;
<span class="hljs-keyword">int</span> index = k%<span class="hljs-number">32</span>;

<span class="hljs-comment">//Creating the mask </span>
<span class="hljs-keyword">int</span> flag = <span class="hljs-number">1</span> &lt;&lt; index; 
flag = ~flag; <span class="hljs-comment">//invert the flag </span>

A[pos] = A[pos] &amp; flag; <span class="hljs-comment">//deleting the value from the array. </span>
</code></pre>
<p class="has-line-data" data-line-start="104" data-line-end="105">Here is a compressed version of the above implementation,</p>
<pre><code class="has-line-data" data-line-start="106" data-line-end="110" class="language-c"><span class="hljs-keyword">int</span> A[<span class="hljs-number">32</span>];
<span class="hljs-keyword">int</span> k = <span class="hljs-number">3</span>; 
A[k/<span class="hljs-number">32</span>] &amp;= ~(<span class="hljs-number">1</span> &lt;&lt; k%<span class="hljs-number">32</span>); 
</code></pre>
<p class="has-line-data" data-line-start="111" data-line-end="112">Understanding bit manipulations can be useful when optimizing functionality in code and even avoid expensive operations (such as looping) just to change a value in an index position by the aid of bit shifting and bit masking.</p>
<p class="has-line-data" data-line-start="113" data-line-end="115">Thanks for reading! :)<br>
Follow me on Twitter : <a href="https://twitter.com/chirathnissanka">@chirathnissanka</a></p>

</body></html>